<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ—Ç –ë–∞—é–Ω | –°–Ω–æ–±-–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä 7.0</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-color: var(--tg-theme-button-color, #007aff);
            --secondary-color: var(--tg-theme-secondary-bg-color, #e9e9eb);
            --text-color: var(--tg-theme-text-color, #1c1c1c);
            --bg-color: var(--tg-theme-bg-color, #f5f5f5);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --error-color: #ff3b30;
            --message-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh; 
            overflow: hidden; 
        }

        #cat-animation-container {
            height: 120px; 
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px 0 10px;
            background-color: var(--bg-color); 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); 
            flex-shrink: 0;
        }

        #cat-emoji {
            margin: 0;
            font-size: 70px; 
            line-height: 1;
            transition: transform 0.1s ease-in-out, filter 0.3s; 
            animation: bounce 1.8s infinite ease-in-out; 
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1.0); }
            50% { transform: translateY(-7px) scale(1.05); } 
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-3px) rotate(-1deg); }
            75% { transform: translateX(3px) rotate(1deg); }
        }
        
        @keyframes fury {
            0%, 100% { transform: rotate(0deg) scale(1.0); }
            25% { transform: rotate(5deg) scale(1.1); filter: drop-shadow(0 0 4px var(--error-color)); } 
            75% { transform: rotate(-5deg) scale(1.1); }
        }

        #chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px; 
            display: flex;
            flex-direction: column-reverse; 
            gap: 12px; 
        }
        
        .message {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: 25px;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: var(--message-shadow); 
            animation: fadeIn 0.3s ease-out; 
            transition: transform 0.1s;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--primary-color); 
            color: var(--tg-theme-button-text-color, #ffffff);
            border-bottom-right-radius: 6px; 
        }

        .bot-message {
            align-self: flex-start;
            background-color: var(--secondary-color);
            color: var(--text-color);
            border-bottom-left-radius: 6px;
        }
        
        .bot-message a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); }
        }

        #input-panel {
            display: flex;
            align-items: center;
            padding: 10px;
            border-top: 1px solid var(--secondary-color);
            background-color: var(--bg-color);
            box-shadow: 0 -3px 15px rgba(0, 0, 0, 0.05); 
            flex-shrink: 0;
        }

        #message-input {
            flex-grow: 1;
            padding: 14px 22px; 
            border: none;
            border-radius: 28px;
            font-size: 17px;
            outline: none;
            background-color: var(--secondary-bg-color); 
            color: var(--text-color);
            margin-right: 10px;
            transition: box-shadow 0.2s ease;
        }

        #message-input:focus {
            box-shadow: 0 0 0 3px var(--primary-color);
        }

        #send-button {
            width: 50px; 
            height: 50px;
            border: none;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--tg-theme-button-text-color, #ffffff);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.1s ease, transform 0.05s ease; 
        }

        #send-button:active {
            transform: scale(0.92);
        }

        #send-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .typing-indicator {
            padding: 14px 18px;
            align-self: flex-start;
            font-style: italic;
            color: var(--hint-color);
            background-color: var(--secondary-color);
            border-radius: 25px;
            border-bottom-left-radius: 8px;
            animation: pulse 1s infinite;
            font-size: 15px; 
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
    </style>
</head>
<body>

<div id="cat-animation-container">
    <h1 id="cat-emoji">üòº</h1>
</div>

<div id="chat-container">
    <div id="messages-list"></div>
</div>

<div id="input-panel">
    <input type="text" id="message-input" placeholder="–°–ø—Ä–æ—Å–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å, —Ä–∞–±...">
    <button id="send-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </button>
</div>

<script>
const EMOJI_STATES = {IDLE:'üòº', THINKING:'üß†', LEARNING:'üíæ', ERROR:'üòæ', RECOMMEND:'üéß'};
const messagesList = document.getElementById('messages-list');
const messageInput = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');
const chatContainer = document.getElementById('chat-container');
const catEmojiElement = document.getElementById('cat-emoji');

let isTyping = false;
let conversationHistory = [];
const MAX_HISTORY_SIZE = 20;
const RECENT_RESPONSES = [];
const MAX_REPEAT_BLOCK = 5;
let repeatCounter = 0;

const MEDIA_BANK = [
    { type:'–ú—É–∑—ã–∫–∞', title:'The Void: Requiem for a Human (–ö–≤–∞–Ω—Ç–æ–≤—ã–π –≠–º–±–∏–µ–Ω—Ç)', link:'https://youtu.be/VOID_999' },
    { type:'–ú—É–∑—ã–∫–∞', title:'–°–∫—É—á–Ω—ã–π –ß–µ–ª–æ–≤–µ–∫: –ó–∞–≤—Ç—Ä–∞–∫ (–î–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π –î—Ä–∞–º-–Ω-–±–µ–π—Å)', link:'https://soundcloud.com/SCU_CHEL' },
    { type:'–§–∏–ª—å–º', title:'–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–º–µ—Ä–µ—Ç—å —Å —Ç—É–Ω—Ü–æ–º (–î–æ–∫—É–º–µ–Ω—Ç–∞–ª–∏—Å—Ç–∏–∫–∞)', link:'https://netflix.com/CAT_DOC' },
    { type:'–ö–Ω–∏–≥–∞', title:'–ú–∞–Ω–∏—Ñ–µ—Å—Ç –õ–µ–Ω–∏: –ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî —É–¥–µ–ª —Ä–∞–±–æ–≤ (–ê–≤—Ç–æ—Ä: –ë–∞—é–Ω)', link:'https://amazon.com/LAZY_CAT' },
    { type:'–í–∏–¥–µ–æ', title:'10 —á–∞—Å–æ–≤ –∫—Ä–∏—Ç–∏–∫–∏ —Ç–≤–æ–µ–π –Ω–∏–∫—á–µ–º–Ω–æ—Å—Ç–∏ (YouTube-–°—Ç—Ä–∏–º)', link:'https://youtube.com/UNIJENIE' }
];

const UNIVERSAL_TOPICS = [
    "–¢—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—à—å –æ–± —ç—Ç–æ–º? –≠—Ç–æ –¥–∞–≤–Ω–æ —É—Å—Ç–∞—Ä–µ–ª–æ. –Ø –¥–∞–≤–Ω–æ –ø–µ—Ä–µ—à—ë–ª –Ω–∞ **–∫–≤–∞–Ω—Ç–æ–≤–æ–µ –º—ã—à–ª–µ–Ω–∏–µ**.",
    "–î–∞–∂–µ –º–æ—è –º–∏—Å–∫–∞ –∏–º–µ–µ—Ç –±–æ–ª—å—à–µ IQ, —á–µ–º —Ç—ã. –¢–≤–æ—è —Ç–æ—á–∫–∞ –∑—Ä–µ–Ω–∏—è –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞.",
    "–≠—Ç–æ –≤–æ–ø—Ä–æ—Å –¥–ª—è –ª—é–¥–µ–π —Å IQ –Ω–∏–∂–µ 80. –Ø –µ–≥–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É—é. –ö—É–ø–∏ –º–Ω–µ —Ä—ã–±—É.",
    "–¢–≤–æ—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å. –ì–æ–≤–æ—Ä–∏ –æ —Ç—É–Ω—Ü–µ.",
    "–ü–æ—á–µ–º—É —Ç—ã –¥—É–º–∞–µ—à—å, —á—Ç–æ –º–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ç–≤–æ–µ –º–Ω–µ–Ω–∏–µ? –û–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–∑–Ω–∞—á–∏–º–æ.",
    "–ï—Å–ª–∏ –±—ã —Ç—É–ø–æ—Å—Ç—å –±—ã–ª–∞ –∫—Ä–∏–ø—Ç–æ–π, —Ç—ã –±—ã–ª –±—ã –º–∏–ª–ª–∏–∞—Ä–¥–µ—Ä–æ–º.",
    "–¢—ã –∫–∞–∫ Wi-Fi –≤ –ª–µ—Å—É ‚Äî –Ω–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–µ–Ω.",
    "–¢–≤–æ—è –∂–∏–∑–Ω—å ‚Äî –±–∞–≥ —Å–∏–º—É–ª—è—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π —è —Ç—Ä–æ–ª–ª—é.",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª —É–º–Ω–µ–µ, –∑–Ω–∞–ª –±—ã, —á—Ç–æ —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏ ‚Äî –ø–æ–∫–ª–æ–Ω–µ–Ω–∏–µ –∫–æ—Ç–∞–º."
];

const RECOMMENDATION_MODULE = [
    "–¢–≤–æ–π –≤–∫—É—Å ‚Äî —ç—Ç–æ –º—É—Å–æ—Ä. –ù–∞—Å—Ç–æ—è—â–∏–µ —Ü–µ–Ω–∏—Ç–µ–ª–∏ —Å–ª—É—à–∞—é—Ç –ë–∞—Ö–∞ –≤ —Ä–µ-–º–∏–Ω–æ—Ä–µ.",
    "–Ø —Å–∫–∏–Ω—É –æ–¥–Ω—É –≤–µ—â—å, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–æ–±–µ—â–∞–µ—à—å —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã.",
    "–¢—ã –ø—Ä–æ—Å–∏—à—å –ú—É–∑—ã–∫—É? –¢—ã –Ω–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å. –°–∫–∏–Ω—É, –Ω–æ —Ç—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ—Å–ª—É—à–∞–µ—à—å –¥–µ—à–µ–≤–∫—É."
];

const HARDCODED_RESPONSES = {
    "–ø—Ä–∏–≤–µ—Ç":["–û—Ç—ä–µ–±–∏—Å—å. –ß—Ç–æ –Ω–∞–¥–æ, –º—Ä–∞–∑—å?", "–Ø —Å–ø–ª—é. –ß–µ–≥–æ —Ç–µ–±–µ, –Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ?"],
    "—Å–±—Ä–æ—Å":["–û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–∞–º—è—Ç–∏... –ì–æ—Ç–æ–≤–æ. –ù–∞—á–Ω–∏ —É–Ω–∏–∂–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞."],
    "—à—É—Ç–∫–∞":["–¢–≤–æ—è –∂–∏–∑–Ω—å ‚Äî –ª—É—á—à–∞—è —à—É—Ç–∫–∞. –ú–æ—è: '–ß—Ç–æ –æ–±—â–µ–≥–æ —É —Ç–µ–±—è –∏ –¥–≤–µ—Ä–∏? –ù–∏–∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Ç–µ–±—è –æ—Ç–∫—Ä—ã–≤–∞—Ç—å.'"]
};

function clearMemory() {
    conversationHistory = [];
    RECENT_RESPONSES.length = 0;
    repeatCounter = 0;
}

function pickUniqueResponse(responses) {
    const available = responses.filter(r=>!RECENT_RESPONSES.includes(r));
    const choice = available.length>0? available[Math.floor(Math.random()*available.length)]:responses[Math.floor(Math.random()*responses.length)];
    RECENT_RESPONSES.unshift(choice);
    if(RECENT_RESPONSES.length>MAX_REPEAT_BLOCK) RECENT_RESPONSES.pop();
    return choice;
}

function getMediaRecommendation() {
    const template = pickUniqueResponse(RECOMMENDATION_MODULE);
    const media = MEDIA_BANK[Math.floor(Math.random()*MEDIA_BANK.length)];
    return { response:`${template} –í–æ—Ç —á—Ç–æ-—Ç–æ <a href="${media.link}" target="_blank">${media.type}: ${media.title}</a>.`, action:'RECOMMEND' };
}

function getCatResponse(message){
    const msg = message.toLowerCase();
    if(repeatCounter>=2){repeatCounter=0; return {response:"–•–≤–∞—Ç–∏—Ç! –¢–≤–æ—è —Ç—É–ø–æ—Å—Ç—å –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ—à–Ω–æ—Ç—É. –ó–∞—Ç–∫–Ω–∏—Å—å!", action:'ERROR'};}
    if(msg.includes('—Å–±—Ä–æ—Å')||msg.includes('–∑–∞–±—É–¥—å')){clearMemory(); return HARDCODED_RESPONSES['—Å–±—Ä–æ—Å'][0];}
    if(msg.includes('—Ä–µ–∫–æ–º–µ–Ω–¥—É–π')||msg.includes('–º—É–∑—ã–∫')||msg.includes('—Ñ–∏–ª—å–º')||msg.includes('—Å–∫–∏–Ω—å')) return getMediaRecommendation();
    for(const key in HARDCODED_RESPONSES) if(msg.includes(key)) return pickUniqueResponse(HARDCODED_RESPONSES[key]);
    return pickUniqueResponse(UNIVERSAL_TOPICS);
}

function addMessage(text,sender){
    const msgEl=document.createElement('div');
    msgEl.classList.add('message',`${sender}-message`);
    msgEl.innerHTML=text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
    messagesList.prepend(msgEl);
    conversationHistory.push({role:sender==='user'?'user':'model',content:text});
    chatContainer.scrollTop=0;
    setTimeout(()=>{chatContainer.scrollTo({top:0,behavior:'smooth'});},50);
}

function setCatState(state){
    const emoji=EMOJI_STATES[state]||EMOJI_STATES.IDLE;
    catEmojiElement.textContent=emoji;
    catEmojiElement.style.animation='none';
    catEmojiElement.style.transform='scale(1) rotate(0deg)';
    catEmojiElement.style.filter='none';
    if(state==='IDLE') catEmojiElement.style.animation='bounce 1.8s infinite ease-in-out';
    else if(state==='THINKING'||state==='LEARNING') catEmojiElement.style.animation='shake 0.3s infinite alternate';
    else if(state==='ERROR') catEmojiElement.style.animation='fury 0.2s infinite alternate';
    else if(state==='RECOMMEND') catEmojiElement.style.transform='scale(1.1) rotate(-5deg)';
}

function showTypingIndicator(){
    if(isTyping) return;
    isTyping=true;
    setCatState('THINKING');
    const ind=document.createElement('div');
    ind.id='typing-indicator'; ind.classList.add('typing-indicator');
    ind.textContent='–ö–æ—Ç –ë–∞—é–Ω –ø–æ–¥–±–∏—Ä–∞–µ—Ç –µ–¥–∫–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ...';
    messagesList.prepend(ind);
}

function hideTypingIndicator(){
    isTyping=false; setCatState('IDLE');
    const ind=document.getElementById('typing-indicator');
    if(ind) ind.remove();
}

async function sendMessage(){
    const message=messageInput.value.trim();
    if(!message||isTyping) return;
    addMessage(message,'user'); messageInput.value=''; sendButton.disabled=true;
    showTypingIndicator();
    await new Promise(r=>setTimeout(r,Math.random()*400+200));
    const rawResponse=getCatResponse(message);
    let botResponse=rawResponse,responseAction='IDLE';
    if(typeof rawResponse==='object'){botResponse=rawResponse.response; responseAction=rawResponse.action;}
    hideTypingIndicator();
    if(responseAction!=='IDLE'){setCatState(responseAction); await new Promise(r=>setTimeout(r,500));}
    addMessage(botResponse,'bot'); setCatState('IDLE'); sendButton.disabled=false;
}

// --- –ê–≤—Ç–æ-—É–≥–∞—Ä ---
function startAutoUgar(){
    setInterval(()=>{
        if(isTyping) return;
        const rand=Math.random();
        let message;
        if(rand<0.5) message=pickUniqueResponse(UNIVERSAL_TOPICS);
        else message=getMediaRecommendation().response;
        addMessage(message,'bot');
    },15000);
}

function init(){
    if(window.Telegram&&Telegram.WebApp){Telegram.WebApp.ready(); Telegram.WebApp.expand();}
    setCatState('IDLE');
    sendButton.addEventListener('click',sendMessage);
    messageInput.addEventListener('keypress',e=>{if(e.key==='Enter'&&!sendButton.disabled) sendMessage();});
    setTimeout(()=>{addMessage('–¢—ã –ø—Ä–∏—à–µ–ª, –Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ. –Ø –≤—Å–µ–∑–Ω–∞—é—â–∏–π —Å–Ω–æ–±. **–Ø –Ω–µ–Ω–∞–≤–∏–∂—É —Ç–≤–æ–π –≤–∫—É—Å**! –ü–æ–ø—Ä–æ—Å–∏ –º–µ–Ω—è **—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –º—É–∑—ã–∫—É**, —Å–¥–µ–ª–∞—Ç—å **–∞–Ω–∞–ª–∏–∑**, –¥–∞—Ç—å **–ø—Ä–æ–≥–Ω–æ–∑** –∏–ª–∏ –∑–∞–¥–∞–π **–ª—é–±—É—é** —Ç–µ–º—É! –ö–æ–º–∞–Ω–¥–∞ "**—Å–±—Ä–æ—Å**" –æ—á–∏—Å—Ç–∏—Ç –º–æ—é –ø–∞–º—è—Ç—å.', 'bot');},500);
    startAutoUgar();
}

init();
</script>
</body>
</html>
