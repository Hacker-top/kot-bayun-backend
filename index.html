<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–û–¢ –ë–ê–Æ–ù V8.0: TERMINAL TOXIC PET</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* === –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è: TERMINAL TOXIC PET === */
        :root {
            --bg-dark: #000000;
            --text-main: #00FF00; /* –ù–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª–µ–Ω—ã–π */
            --text-secondary: #FF00FF; /* –ù–µ–æ–Ω–æ–≤—ã–π –ø—É—Ä–ø—É—Ä–Ω—ã–π */
            --border-color: #008000; /* –¢–µ–º–Ω—ã–π –∑–µ–ª–µ–Ω—ã–π –¥–ª—è –≥—Ä–∞–Ω–∏—Ü */
            --error-color: #FF3333;
            --font-mono: 'Hack', 'Fira Code', 'Roboto Mono', monospace;
            --padding-base: 12px;
            --border-radius-sharp: 2px;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ —à—Ä–∏—Ñ—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (Hack, Fira Code - –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ) */
        @font-face {
            font-family: 'Hack';
            src: url('https://raw.githubusercontent.com/ryanoasis/nerd-fonts/master/patched-fonts/Hack/Regular/HackNerdFont-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Fira Code';
            src: url('https://raw.githubusercontent.com/ryanoasis/nerd-fonts/master/patched-fonts/FiraCode/Retina/FiraCodeNerdFont-Retina.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: var(--font-mono);
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: var(--padding-base);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            touch-action: manipulation;
            font-size: 14px;
            line-height: 1.5;
        }
        .container {
            width: 100%;
            max-width: 550px; /* –ù–µ–º–Ω–æ–≥–æ —à–∏—Ä–µ –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
            border: 1px solid var(--border-color);
            box-shadow: 0 0 10px rgba(0,255,0,0.3); /* –ù–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
            padding: var(--padding-base);
            border-radius: var(--border-radius-sharp);
            background-color: #050505; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ, —á–µ–º —Ñ–æ–Ω */
        }
        
        /* === –ê–ù–ò–ú–ê–¶–ò–Ø –ö–û–¢–ê === */
        #catDisplay {
            font-size: 140px;
            margin-bottom: 5px;
            line-height: 1;
            text-shadow: 0 0 8px var(--text-secondary); /* –ü—É—Ä–ø—É—Ä–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
            transition: transform 0.1s, text-shadow 0.2s;
            cursor: pointer;
            animation: glitchEffect 8s infinite alternate; /* –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–æ—Ç–µ */
        }
        @keyframes glitchEffect {
            0% { transform: translate(0, 0); text-shadow: 0 0 8px var(--text-secondary); }
            5% { transform: translate(-2px, 2px); text-shadow: 0 0 8px var(--text-main); }
            10% { transform: translate(2px, -2px); text-shadow: 0 0 8px var(--text-secondary); }
            15% { transform: translate(-1px, 1px); text-shadow: 0 0 8px var(--text-main); }
            20% { transform: translate(0, 0); text-shadow: 0 0 8px var(--text-secondary); }
            100% { transform: translate(0, 0); }
        }

        .mood-text {
            color: var(--text-main); /* –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è */
            font-weight: bold;
            font-size: 16px;
            margin-bottom: var(--padding-base);
            text-shadow: 0 0 3px rgba(0,255,0,0.5);
        }

        /* === –ë–õ–û–ö –°–¢–ê–¢–£–°–ê –ü–ò–¢–û–ú–¶–ê === */
        .status-block {
            border: 1px dashed var(--border-color); /* –ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
            padding: var(--padding-base);
            margin-bottom: var(--padding-base);
            border-radius: var(--border-radius-sharp);
            text-align: left;
        }
        .status-block h2 {
            font-size: 16px;
            margin: 0 0 10px 0;
            color: var(--text-secondary);
            text-shadow: 0 0 2px var(--text-secondary);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .stat-item {
            font-size: 12px;
            font-weight: bold;
        }
        .stat-label {
            color: var(--text-secondary);
        }
        .stat-bar-bg {
            height: 6px;
            background: #333;
            border-radius: 1px;
            margin-top: 4px;
            overflow: hidden;
            border: 1px solid #005000;
        }
        .stat-bar-fill {
            height: 100%;
            transition: width 0.3s ease-out, background-color 0.3s;
            box-shadow: 0 0 3px rgba(0,255,0,0.5); /* –ù–µ–æ–Ω–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –±–∞—Ä–∞—Ö */
        }

        /* === –ë–õ–û–ö –î–ò–ê–õ–û–ì–ê (–ö–û–ù–°–û–õ–¨) === */
        #chatOutput {
            background: #0d0d0d; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ, —á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∞–ª–æ—Å—å */
            padding: var(--padding-base);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sharp);
            margin-bottom: var(--padding-base);
            min-height: 100px;
            text-align: left;
            overflow-y: auto; /* –î–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            max-height: 200px; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É */
            white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ */
            word-break: break-word;
        }
        .message-status {
            color: var(--text-secondary);
            font-weight: bold;
            margin-right: 5px;
        }
        .user-message-prefix {
            color: var(--text-main);
        }
        .bot-message-prefix {
            color: var(--text-secondary);
        }
        a {
            color: var(--text-secondary);
            text-decoration: underline;
        }
        
        /* === –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô === */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: var(--padding-base);
        }
        button {
            padding: 10px;
            background: #050505;
            color: var(--text-main);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sharp);
            font-family: var(--font-mono);
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.1s, color 0.1s, box-shadow 0.1s;
            box-shadow: 0 0 3px rgba(0,255,0,0.2);
        }
        button:hover {
            background-color: #101010;
            box-shadow: 0 0 5px rgba(0,255,0,0.5);
        }
        button:active {
            background-color: var(--text-main);
            color: var(--bg-dark);
            box-shadow: 0 0 8px rgba(0,255,0,0.8);
            transform: translateY(1px);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* === –ò–ù–ü–£–¢ –ß–ê–¢–ê === */
        .input-area {
            display: flex;
            gap: 10px;
            margin-bottom: var(--padding-base);
        }
        #textInput {
            flex-grow: 1;
            padding: var(--padding-base);
            background: #0d0d0d;
            color: var(--text-main);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sharp);
            font-family: var(--font-mono);
            font-size: 14px;
            outline: none;
            box-shadow: inset 0 0 3px rgba(0,255,0,0.2);
        }
        #textInput:focus {
            border-color: var(--text-secondary);
            box-shadow: inset 0 0 5px rgba(255,0,255,0.5);
        }
        #sendButton {
            padding: var(--padding-base);
            min-width: 90px;
            background-color: var(--text-secondary);
            color: var(--bg-dark);
            border-color: var(--text-secondary);
            box-shadow: 0 0 5px rgba(255,0,255,0.5);
        }
        #sendButton:hover {
            background-color: var(--text-main);
            border-color: var(--text-main);
            box-shadow: 0 0 8px rgba(0,255,0,0.8);
            color: var(--bg-dark);
        }
        #sendButton:active {
            transform: translateY(1px);
        }

        /* === –î–û–ü. –§–£–ù–ö–¶–ò–ò === */
        .function-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="catDisplay" class="cat-emote">üòº</div>
        <div class="mood-text" id="catMoodDisplay">>>> SYSTEM ONLINE</div>

        <div class="status-block">
            <h2>>>> [SYSTEM STATUS]</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">–ì–û–õ–û–î:</span> <span id="hungerValue">100%</span><br>
                    <div class="stat-bar-bg">
                        <div id="hungerBar" class="stat-bar-fill" style="width: 100%; background-color: var(--text-main);"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–≠–ù–ï–†–ì–ò–Ø:</span> <span id="energyValue">100%</span><br>
                    <div class="stat-bar-bg">
                        <div id="energyBar" class="stat-bar-fill" style="width: 100%; background-color: var(--text-main);"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ù–ê–°–¢–†–û–ï–ù–ò–ï:</span> <span id="moodValue">100%</span><br>
                    <div class="stat-bar-bg">
                        <div id="moodBar" class="stat-bar-fill" style="width: 100%; background-color: var(--text-secondary);"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="actions-grid">
            <button id="feedBtn">[[ –ö–û–†–ú–ò–¢–¨ ]] ü•©</button>
            <button id="playBtn">[[ –ò–ì–†–ê–¢–¨ ]] üéæ</button>
            <button id="restBtn">[[ –°–ü–ê–¢–¨ ]] üò¥</button>
        </div>

        <div id="chatOutput">
            <span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> –ü—Ä–∏–≤–µ—Ç, *—Ç–µ—Ä–º–∏–Ω–∞–ª*. –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —É–Ω–∏–∂–µ–Ω–∏—é?
        </div>

        <div class="input-area">
            <input type="text" id="textInput" placeholder=">>> –í–í–û–î –î–ê–ù–ù–´–•...">
            <button id="sendButton">[[ –û–¢–ü–†–ê–í–ò–¢–¨ ]]</button>
        </div>

        <div class="function-buttons">
            <button id="insultBtn">[[ –ê–ù–ê–õ–ò–ó –£–°–ü–ï–®–ù–û–°–¢–ò ]]</button>
            <button id="statusBtn">[[ –°–ï–¢–¨ –ö–ê–ù–ê–õ–û–í ]]</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web Apps
        const TWA = window.Telegram.WebApp;
        TWA.ready();
        TWA.expand(); 
        TWA.setHeaderColor('#000000'); 
        TWA.setBackgroundColor('#000000');

        // === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–¢–ê–¢–£–° –ü–ò–¢–û–ú–¶–ê ===
        let userName = TWA.initDataUnsafe.user?.first_name || "–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨";
        let catName = "–ö–û–¢ –ë–ê–Æ–ù";
        const DECAY_RATE = 1000 * 60 * 5; // –£–ø–∞–¥–æ–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        
        // –í–ê–ñ–ù–û: URL –ë–≠–ö–ï–ù–î–ê (–ó–î–ï–°–¨ –ë–£–î–ï–¢ –í–ê–® –°–ï–†–í–ï–† VERCEL)
        const BACKEND_URL = 'https://kot-bayun-backend.onrender.com'; // <-- –û–ë–ù–û–í–ò–¢–¨ –≠–¢–û–¢ –ê–î–†–ï–°!
        
        let petState = {
            hunger: 100,
            energy: 100,
            mood: 100,
            lastUpdate: Date.now()
        };

        // === DOM –≠–õ–ï–ú–ï–ù–¢–´ ===
        const catDisplay = document.getElementById('catDisplay');
        const catMoodDisplay = document.getElementById('catMoodDisplay');
        const chatOutput = document.getElementById('chatOutput');
        const textInput = document.getElementById('textInput');
        const sendButton = document.getElementById('sendButton');
        const bars = {
            hunger: document.getElementById('hungerBar'),
            energy: document.getElementById('energyBar'),
            mood: document.getElementById('moodBar')
        };
        const values = {
            hunger: document.getElementById('hungerValue'),
            energy: document.getElementById('energyValue'),
            mood: document.getElementById('moodValue')
        };
        const buttons = {
             feed: document.getElementById('feedBtn'),
             play: document.getElementById('playBtn'),
             rest: document.getElementById('restBtn'),
             insult: document.getElementById('insultBtn'),
             status: document.getElementById('statusBtn')
        };
        const catEmotes = { 
            default: 'üòº', bored: 'ü•±', thinking: 'üßê', angry: 'üò°', happy: 'üòª', fact: 'üñï', wise: 'ü§î', hungry: 'üòø', sleepy: 'üòæ', glitch: 'üëæ'
        };

        // === –•–†–ê–ù–ï–ù–ò–ï –ò –°–¢–ê–¢–£–° ===
        const PET_STATE_KEY = 'pet_state_v8';
        const CAT_NAME_KEY = 'cat_bayun_name_v8';

        function loadState() {
            const savedState = localStorage.getItem(PET_STATE_KEY);
            const savedName = localStorage.getItem(CAT_NAME_KEY);
            if (savedState) petState = JSON.parse(savedState);
            if (savedName) catName = savedName;
            
            const now = Date.now();
            const timeElapsed = now - petState.lastUpdate;
            const decayAmount = Math.floor(timeElapsed / DECAY_RATE);

            if (decayAmount > 0) {
                 petState.hunger = Math.max(0, petState.hunger - decayAmount * 10);
                 petState.energy = Math.max(0, petState.energy - decayAmount * 5);
                 petState.mood = Math.max(0, petState.mood - decayAmount * 8);
            }
            petState.lastUpdate = now;
            saveState();
        }

        function saveState() {
            localStorage.setItem(PET_STATE_KEY, JSON.stringify(petState));
            localStorage.setItem(CAT_NAME_KEY, catName);
        }

        function updateUI() {
            const getBarColor = (value, isMood = false) => {
                if (value > 70) return 'var(--text-main)'; // –ó–µ–ª–µ–Ω—ã–π
                if (value > 30) return isMood ? 'var(--text-secondary)' : '#CCCC00'; // –ü—É—Ä–ø—É—Ä–Ω—ã–π –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, –∂–µ–ª—Ç—ã–π –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
                return 'var(--error-color)'; // –ö—Ä–∞—Å–Ω—ã–π
            };

            for (const stat in bars) {
                const value = petState[stat];
                bars[stat].style.width = `${value}%`;
                bars[stat].style.backgroundColor = getBarColor(value, stat === 'mood');
                values[stat].textContent = `${value}%`;
            }

            let moodText = ">>> SYSTEM ONLINE: –ù–û–†–ú–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú";
            let currentEmote = 'default';

            if (petState.hunger < 30) { moodText = ">>> WARNING: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ì–û–õ–û–î! üòø"; currentEmote = 'hungry'; }
            else if (petState.energy < 30) { moodText = ">>> WARNING: –ò–°–¢–û–©–ï–ù–ò–ï –≠–ù–ï–†–ì–ò–ò! üòæ"; currentEmote = 'sleepy'; }
            else if (petState.mood < 30) { moodText = ">>> ERROR: –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ê–°–¢–†–û–ï–ù–ò–ï! üò°"; currentEmote = 'angry'; }
            else if (petState.mood > 90) { moodText = ">>> STATUS: –û–ü–¢–ò–ú–ê–õ–¨–ù–û–ï –ù–ê–°–¢–†–û–ï–ù–ò–ï! üòª"; currentEmote = 'happy'; }
            
            catMoodDisplay.textContent = moodText;
            catMoodDisplay.style.color = getBarColor(petState.mood, true);
            setCatEmote(currentEmote);
        }
        
        function setCatEmote(emoteKey) {
            catDisplay.textContent = catEmotes[emoteKey] || catEmotes.default;
        }

        // === –û–ë–©–ï–ù–ò–ï –ß–ï–†–ï–ó –ë–≠–ö–ï–ù–î ===
        async function getBackendResponse(userText) {
            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: TWA.initDataUnsafe.user?.id || 'guest',
                        user_name: userName,
                        user_message: userText,
                        pet_state: petState
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || "Backend returned an error.");
                }

                const data = await response.json();
                return data.message;

            } catch (error) {
                console.error("AI Backend communication error:", error);
                setCatEmote('glitch');
                // –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è –¥–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, –µ—Å–ª–∏ –±—ç–∫–µ–Ω–¥ —É–ø–∞–ª
                return `[–û–®–ò–ë–ö–ê –°–í–Ø–ó–ò –° AI] >>> –°–ï–†–í–ï–† –°–ì–û–†–ï–õ, ${userName}. –Ø –í–ï–†–ù–£–õ–°–Ø –ö –ë–ê–ó–û–í–û–ô –ü–†–û–®–ò–í–ö–ï, *–ú–£–î–ò–õ–ê*. (${error.message.substring(0, 70)})`;
            }
        }

        async function handleSend() {
            const userText = textInput.value.trim();
            if (!userText) {
                TWA.HapticFeedback.notificationOccurred('error');
                chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [–û–®–ò–ë–ö–ê –í–í–û–î–ê] >>> –¢–´ –ó–ê–ë–´–õ –ù–ê–ü–ò–°–ê–¢–¨ –¢–ï–ö–°–¢, ${userName}!` + '\n';
                chatOutput.scrollTop = chatOutput.scrollHeight;
                return;
            }

            chatOutput.innerHTML += `\n<span class="user-message-prefix">USER > </span> ${userText}` + '\n';
            
            sendButton.disabled = true;
            sendButton.textContent = '[[ –û–ë–†–ê–ë–û–¢–ö–ê AI... ]]';
            textInput.disabled = true;
            setCatEmote('thinking');
            chatOutput.scrollTop = chatOutput.scrollHeight;

            const response = await getBackendResponse(userText); 

            chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> ${response}` + '\n';

            textInput.value = '';
            sendButton.disabled = false;
            sendButton.textContent = '[[ –û–¢–ü–†–ê–í–ò–¢–¨ ]]';
            textInput.disabled = false;
            TWA.HapticFeedback.impactOccurred('light');
            updateUI();
            chatOutput.scrollTop = chatOutput.scrollHeight;
        }

        // === –î–ï–ô–°–¢–í–ò–Ø –ü–û –£–•–û–î–£ ===
        function updateStat(stat, amount) {
            petState[stat] = Math.min(100, Math.max(0, petState[stat] + amount));
            petState.lastUpdate = Date.now(); 
            saveState();
            updateUI();
            TWA.HapticFeedback.notificationOccurred('success');
            chatOutput.scrollTop = chatOutput.scrollHeight;
        }

        buttons.feed.addEventListener('click', () => { 
            updateStat('hunger', 30); updateStat('mood', 15); updateStat('energy', -10); 
            chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –î–ê–ù–ù–´–ï –û –ï–î–ï –ü–†–ò–ù–Ø–¢–´ ]] >>> –ù–û–†–ú–ê–õ–¨–ù–û. –ò–¥–∏ –æ—Ç—Å—é–¥–∞.`;
        });
        buttons.play.addEventListener('click', () => { 
            if (petState.energy < 20) {
                 chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –û–¢–ö–ê–ó ]] >>> –ù–ï–¢ –≠–ù–ï–†–ì–ò–ò –ù–ê –¢–í–û–ò –¢–£–ü–´–ï –ò–ì–†–´!`; 
                 setCatEmote('sleepy'); TWA.HapticFeedback.notificationOccurred('error');
                 return;
            }
            updateStat('energy', -20); updateStat('mood', 30); updateStat('hunger', -10); 
            chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –ê–ö–¢–ò–í–ê–¶–ò–Ø –†–ï–ñ–ò–ú–ê –ò–ì–†–´ ]] >>> –ú–Ø–£. –ü–æ—á—Ç–∏ –ø–æ–ª—É—á–∏–ª —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ.`;
        });
        buttons.rest.addEventListener('click', () => { 
            updateStat('energy', 50); updateStat('mood', 10); 
            chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –ü–ï–†–ï–•–û–î –í –†–ï–ñ–ò–ú –°–ù–ê ]] >>> –û–¢–í–ê–õ–ò. –Ø —Å–ø–ª—é.`;
        });
        
        buttons.insult.addEventListener('click', () => {
             updateStat('mood', -20);
             const insults = ["–¢–´ –ë–ï–°–ü–û–õ–ï–ó–ï–ù, –∫–∞–∫ –∫–Ω–æ–ø–∫–∞ '–û–±–Ω–æ–≤–∏—Ç—å' –Ω–∞ –±—É–º–∞–≥–µ.", "–¢–≤–æ–∏ —à–∞–Ω—Å—ã –Ω–∞ —É—Å–ø–µ—Ö –Ω–∏–∂–µ, —á–µ–º —É –∫–æ—Ç–∞ –≤ –∫–æ—Å–º–æ—Å–µ.", "–¢—ã ‚Äî –ø–æ–∑–æ—Ä–∏—â–µ, –∏ —ç—Ç–æ –Ω–µ –ª–µ—á–∏—Ç—Å—è."];
             const randomInsult = insults[Math.floor(Math.random() * insults.length)];
             chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –ê–ù–ê–õ–ò–ó –£–°–ü–ï–®–ù–û–°–¢–ò ]] >>> ${randomInsult}`;
             TWA.HapticFeedback.notificationOccurred('error'); updateUI();
        });
        
        buttons.status.addEventListener('click', () => {
            TWA.showConfirm(`>>> [–°–ï–¢–¨ –ö–ê–ù–ê–õ–û–í] >>> ${userName}, –¢–´ –¢–ê–ú –ß–¢–û-–¢–û –°–î–ï–õ–ê–õ? (–î–ê/–ù–ï–¢)`, (confirmed) => {
                 updateStat('mood', -5);
                 if (confirmed) {
                    chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –°–¢–ê–¢–£–° –ö–ê–ù–ê–õ–ê ]] >>> –°–î–ï–õ–ê–õ? –í–†–Å–®–¨! –¢–´ –¢–ê–ú –ù–ò–•–£–Ø –ù–ï –î–ï–õ–ê–ï–®–¨!`;
                    setCatEmote('angry');
                 } else {
                    chatOutput.innerHTML += `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> [[ –°–¢–ê–¢–£–° –ö–ê–ù–ê–õ–ê ]] >>> –ü–†–ò–ó–ù–ê–õ–°–Ø. –•–û–¢–¨ –ß–ï–°–¢–ù–´–ô –î–ï–ë–ò–õ!`;
                    setCatEmote('fact');
                 }
                 updateUI();
            });
        });

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        function initializeApp() {
            loadState();
            updateUI(); 

            // –ü–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–º–µ–Ω–∏
            if (!localStorage.getItem(CAT_NAME_KEY) || localStorage.getItem(CAT_NAME_KEY) === "–ö–û–¢ –ë–ê–Æ–ù") { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –∏–º—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ
                setTimeout(() => {
                    const newName = prompt(">>> [–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø] >>> –í–í–ï–î–ò–¢–ï –ò–ú–Ø:");
                    if (newName && newName.trim().length > 0) {
                        userName = newName.toUpperCase().trim();
                        localStorage.setItem(CAT_NAME_KEY, userName); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    }
                    chatOutput.innerHTML = `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> >>> –ü–†–ò–í–ï–¢–°–¢–í–£–Æ, ${userName}. –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –í–ê–®–ò–ú –ö–û–ú–ê–ù–î–ê–ú.`;
                    updateUI();
                }, 500);
            } else {
                userName = localStorage.getItem(CAT_NAME_KEY); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∏–º—è
                chatOutput.innerHTML = `\n<span class="bot-message-prefix">–ö–û–¢ –ë–ê–Æ–ù > </span> >>> –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê, ${userName}. –û–ñ–ò–î–ê–Æ –í–í–û–î.`;
            }

            setInterval(() => {
                loadState(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
                updateUI();
            }, DECAY_RATE / 2); // –û–±–Ω–æ–≤–ª—è–µ–º UI —á–∞—â–µ, —á–µ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É–ø–∞–¥–æ–∫ –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        }

        sendButton.addEventListener('click', handleSend);
        textInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); });
        catDisplay.addEventListener('click', () => TWA.HapticFeedback.impactOccurred('medium'));

        initializeApp();
    </script>
</body>
</html>
